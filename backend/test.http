### Variables globales
@baseUrl = http://localhost:3001/api
@adminToken = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NTUsImVtYWlsIjoiYWRtaW5AZGVvcy5jb20iLCJyb2xlcyI6WyJhZG1pbiJdLCJpYXQiOjE3NDkwMzc5MTcsImV4cCI6MTc0OTA2NjcxN30.6Va5zKlBFq04dt31raABA4dldeY57rG8jIA-VFMkMGc

### ===========================================
### 🔐 AUTENTICACIÓN Y SEGURIDAD
### ===========================================

### Registro de usuario
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "dni": "88888888",
  "nombre": "Nuevo",
  "apellido": "Usuario",
  "email": "nuevo2@example.com",
  "contraseña": "password123",
  "roles": ["alumno"]
}

### Login de usuario
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@deos.com",
  "contraseña": "admin123"
}

### Solicitar reset de contraseña
POST {{baseUrl}}/auth/request-password-reset
Content-Type: application/json

{
  "email": "admin@deos.com"
}

### Resetear contraseña con token
POST {{baseUrl}}/auth/reset-password
Content-Type: application/json

{
  "token": "your_reset_token_here",
  "newPassword": "newpassword123"
}

### Cambiar contraseña (requiere autenticación)
POST {{baseUrl}}/auth/change-password
Authorization: {{adminToken}}
Content-Type: application/json

{
  "currentPassword": "admin123",
  "newPassword": "newpassword123"
}

### ===========================================
### 👤 GESTIÓN DE USUARIOS
### ===========================================

# Crear un nuevo usuario (admin)
POST {{baseUrl}}/users
Authorization: {{adminToken}}
Content-Type: application/json

{
  "dni": "12345678",
  "nombre": "Test",
  "apellido": "User",
  "email": "test@example.com",
  "contraseña": "password123",
  "roles": ["admin"]
}

### Ver usuario por ID
GET {{baseUrl}}/users/1
Authorization: {{adminToken}}

### Actualizar usuario
PUT {{baseUrl}}/users/1
Authorization: {{adminToken}}
Content-Type: application/json

{
  "nombre": "Test Updated",
  "email": "test.updated@example.com"
}

### Asignar rol a usuario
POST {{baseUrl}}/users/1/roles
Authorization: {{adminToken}}
Content-Type: application/json

{
  "rol": "profesor"
}

### 2. Gestión Académica

# Crear curso
POST {{baseUrl}}/academic/cursos
Authorization: {{adminToken}}
Content-Type: application/json

{
  "año": 1
}

### Crear división
POST {{baseUrl}}/academic/divisiones
Authorization: {{adminToken}}
Content-Type: application/json

{
  "division": "A"
}

### Crear curso-división
POST {{baseUrl}}/academic/cursos-divisiones
Authorization: {{adminToken}}
Content-Type: application/json

{
  "cursoId": 1,
  "divisionId": 1
}

### Crear materia
POST {{baseUrl}}/academic/materias
Authorization: {{adminToken}}
Content-Type: application/json

{
  "nombre": "Matemáticas",
  "cargaHoraria": 4
}

### Asignar materia a curso-división
POST {{baseUrl}}/academic/cursos-divisiones/materias
Authorization: {{adminToken}}
Content-Type: application/json

{
  "cursoDivisionId": 1,
  "materiaId": 1
}

### Asignar profesor a materia
POST {{baseUrl}}/academic/profesores/materias
Authorization: {{adminToken}}
Content-Type: application/json

{
  "usuarioId": 2,
  "materiaId": 1
}

### Asignar alumno a curso
POST {{baseUrl}}/academic/alumnos/cursos
Authorization: {{adminToken}}
Content-Type: application/json

{
  "usuarioId": 3,
  "cursoDivisionId": 1
}

### 3. Gestión de Dispositivos

# Crear dispositivo
POST {{baseUrl}}/devices
Authorization: {{adminToken}}
Content-Type: application/json

{
  "identificadorUnico": "ESP32_001",
  "descripcion": "Dispositivo de prueba",
  "ubicacion": "Entrada principal"
}

### Obtener dispositivos
GET {{baseUrl}}/devices
Authorization: {{adminToken}}

### Actualizar dispositivo
PUT {{baseUrl}}/devices/1
Authorization: {{adminToken}}
Content-Type: application/json

{
  "descripcion": "Dispositivo actualizado",
  "ubicacion": "Nueva ubicación"
}

### 4. Relación Alumno-Padre

# Asignar padre a alumno
POST {{baseUrl}}/users/alumnos/3/padres
Authorization: {{adminToken}}
Content-Type: application/json

{
  "padreId": 4
}

### Ver padres de un alumno
GET {{baseUrl}}/users/alumnos/3/padres
Authorization: {{adminToken}}

### Ver alumnos de un padre
GET {{baseUrl}}/users/padres/4/alumnos
Authorization: {{adminToken}}

### ===========================================
### 📊 SISTEMA BIOMÉTRICO
### ===========================================

### Registrar huella dactilar
POST {{baseUrl}}/biometric/fingerprints
Authorization: {{adminToken}}
Content-Type: application/json

{
  "usuario_id": 56,
  "sensor_id": 10,
  "template": "base64_encoded_fingerprint_template_here"
}

### Actualizar huella dactilar
PUT {{baseUrl}}/biometric/fingerprints/56
Authorization: {{adminToken}}
Content-Type: application/json

{
  "sensor_id": 15,
  "template": "new_base64_encoded_template"
}

### Obtener huella por usuario
GET {{baseUrl}}/biometric/fingerprints/56
Authorization: {{adminToken}}

### Obtener todas las huellas
GET {{baseUrl}}/biometric/fingerprints
Authorization: {{adminToken}}

### Eliminar huella
DELETE {{baseUrl}}/biometric/fingerprints/56
Authorization: {{adminToken}}

### ===========================================
### 📋 REGISTROS DE FICHAJE
### ===========================================

### Crear registro de fichaje
POST {{baseUrl}}/biometric/records
Authorization: {{adminToken}}
Content-Type: application/json

{
  "usuario_id": 56,
  "dispositivo_fichaje_id": 1
}

### Crear registro manual
POST {{baseUrl}}/biometric/records/manual
Authorization: {{adminToken}}
Content-Type: application/json

{
  "usuario_id": 56,
  "tipo": "ingreso",
  "fecha": "2025-06-04T08:00:00Z",
  "origen": "Registro manual por admin"
}

### Obtener registros por usuario
GET {{baseUrl}}/biometric/records/user/56?fecha_desde=2025-06-01&fecha_hasta=2025-06-30
Authorization: {{adminToken}}

### Obtener todos los registros
GET {{baseUrl}}/biometric/records?fecha_desde=2025-06-01&fecha_hasta=2025-06-30&limit=50
Authorization: {{adminToken}}

### Endpoint para ESP32 (sin autenticación JWT)
POST {{baseUrl}}/esp32/biometric-record
Content-Type: application/json

{
  "template": "fingerprint_template_from_sensor",
  "dispositivo_id": "ESP32_ENTRADA_PRINCIPAL"
}

### ===========================================
### 📅 GESTIÓN DE HORARIOS
### ===========================================

### Crear horario
POST {{baseUrl}}/horarios
Authorization: {{adminToken}}
Content-Type: application/json

{
  "curso_division_id": 13,
  "dia": "Lunes",
  "hora_inicio": "08:00:00",
  "hora_fin": "09:20:00",
  "curso_division_materia_id": 1,
  "profesor_usuario_id": 57
}

### Obtener horario por ID
GET {{baseUrl}}/horarios/1
Authorization: {{adminToken}}

### Actualizar horario
PUT {{baseUrl}}/horarios/1
Authorization: {{adminToken}}
Content-Type: application/json

{
  "hora_inicio": "08:30:00",
  "hora_fin": "09:50:00"
}

### Eliminar horario
DELETE {{baseUrl}}/horarios/1
Authorization: {{adminToken}}

### Obtener horarios por curso-división
GET {{baseUrl}}/horarios/curso/13
Authorization: {{adminToken}}

### Obtener horarios por profesor
GET {{baseUrl}}/horarios/profesor/57
Authorization: {{adminToken}}

### ===========================================
### 📊 REPORTES Y ANÁLISIS
### ===========================================

### Reporte general de asistencia
GET {{baseUrl}}/reports/attendance?fecha_desde=2025-06-01&fecha_hasta=2025-06-30&curso_division_id=13
Authorization: {{adminToken}}

### Resumen de asistencia con estadísticas
GET {{baseUrl}}/reports/attendance/summary?fecha_desde=2025-06-01&fecha_hasta=2025-06-30
Authorization: {{adminToken}}

### Reporte de asistencia por materia
GET {{baseUrl}}/reports/attendance/subject/1?fecha_desde=2025-06-01&fecha_hasta=2025-06-30
Authorization: {{adminToken}}

### Reporte de profesor
GET {{baseUrl}}/reports/teacher/57?fecha_desde=2025-06-01&fecha_hasta=2025-06-30
Authorization: {{adminToken}}

### ===========================================
### 📝 SISTEMA DE LOGS
### ===========================================

### Obtener todos los logs
GET {{baseUrl}}/logs?limit=50&offset=0
Authorization: {{adminToken}}

### Crear log manual
POST {{baseUrl}}/logs
Authorization: {{adminToken}}
Content-Type: application/json

{
  "usuario_id": 55,
  "tipo": "auditoria",
  "descripcion": "Prueba de log manual",
  "origen": "TEST_MANUAL"
}

### Obtener logs por usuario
GET {{baseUrl}}/logs/user/55?limit=20
Authorization: {{adminToken}}

### Obtener logs del sistema
GET {{baseUrl}}/logs/system?fecha_desde=2025-06-01
Authorization: {{adminToken}}

### Obtener logs de errores
GET {{baseUrl}}/logs/errors?fecha_desde=2025-06-01
Authorization: {{adminToken}}

### Obtener logs de seguridad
GET {{baseUrl}}/logs/security?fecha_desde=2025-06-01
Authorization: {{adminToken}} 