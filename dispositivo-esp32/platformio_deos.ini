[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; ========== CONFIGURACIÓN BÁSICA ==========
monitor_speed = 115200
upload_speed = 921600
board_build.mcu = esp32
board_build.f_cpu = 240000000L

; ========== LIBRERÍAS REQUERIDAS ==========
lib_deps = 
    adafruit/Adafruit Fingerprint Sensor Library@^2.1.0
    knolleary/PubSubClient@^2.8
    bblanchon/ArduinoJson@^6.21.3
    me-no-dev/ESP Async WebServer@^1.2.3
    me-no-dev/AsyncTCP@^1.1.1

; ========== CONFIGURACIÓN DE COMPILACIÓN ==========
build_flags = 
    -DCORE_DEBUG_LEVEL=1
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DDEOS_BIOMETRIC_VERSION=\"1.0.0\"
    -DDEOS_DEVICE_ID=\"ESP32_AULA_A1\"
    -DARDUINO_USB_CDC_ON_BOOT=1

; ========== CONFIGURACIÓN DE MEMORIA ==========
board_build.partitions = huge_app.csv
board_build.filesystem = spiffs

; ========== CONFIGURACIÓN DE DEBUG ==========
debug_tool = esp-prog
debug_init_break = tbreak setup

; ========== CONFIGURACIÓN DE UPLOAD ==========
upload_protocol = esptool
upload_port = /dev/cu.usbserial-*

; ========== CONFIGURACIÓN ESPECÍFICA DEOS ==========
; WiFi por defecto
build_flags = 
    ${env:esp32dev.build_flags}
    -DDEFAULT_WIFI_SSID=\"DEOS_WiFi\"
    -DDEFAULT_WIFI_PASSWORD=\"deos2024\"
    -DDEFAULT_MQTT_SERVER=\"192.168.1.100\"
    -DDEFAULT_MQTT_PORT=1883
    -DDEFAULT_DEVICE_LOCATION=\"Aula_A1_PB\"

; ========== ENVIRONMENT PARA DESARROLLO ==========
[env:esp32dev_debug]
extends = env:esp32dev
build_type = debug
build_flags = 
    ${env:esp32dev.build_flags}
    -DDEBUG_MODE=1
    -DCORE_DEBUG_LEVEL=5
    -DSERIAL_DEBUG=1

monitor_filters = 
    esp32_exception_decoder
    time

; ========== ENVIRONMENT PARA PRODUCCIÓN ==========
[env:esp32dev_release]
extends = env:esp32dev
build_type = release
build_flags = 
    ${env:esp32dev.build_flags}
    -DDEBUG_MODE=0
    -DCORE_DEBUG_LEVEL=0
    -O2

; Optimizaciones de compilación
board_build.f_flash = 80000000L
board_build.flash_mode = qio

; ========== ENVIRONMENT PARA TESTING ==========
[env:esp32dev_test]
extends = env:esp32dev_debug
build_flags = 
    ${env:esp32dev_debug.build_flags}
    -DTEST_MODE=1
    -DMOCK_SENSOR=1

test_framework = unity
test_build_src = yes

; ========== CONFIGURACIÓN DE DIFERENTES AULAS ==========
[env:aula_a1]
extends = env:esp32dev_release
build_flags = 
    ${env:esp32dev_release.build_flags}
    -DDEOS_DEVICE_ID=\"ESP32_AULA_A1\"
    -DDEFAULT_DEVICE_LOCATION=\"Aula_A1_PB\"

[env:aula_b2]
extends = env:esp32dev_release
build_flags = 
    ${env:esp32dev_release.build_flags}
    -DDEOS_DEVICE_ID=\"ESP32_AULA_B2\"
    -DDEFAULT_DEVICE_LOCATION=\"Aula_B2_PA\"

[env:laboratorio]
extends = env:esp32dev_release
build_flags = 
    ${env:esp32dev_release.build_flags}
    -DDEOS_DEVICE_ID=\"ESP32_LABORATORIO\"
    -DDEFAULT_DEVICE_LOCATION=\"Laboratorio_Informatica\"

[env:biblioteca]
extends = env:esp32dev_release
build_flags = 
    ${env:esp32dev_release.build_flags}
    -DDEOS_DEVICE_ID=\"ESP32_BIBLIOTECA\"
    -DDEFAULT_DEVICE_LOCATION=\"Biblioteca_Principal\"

; ========== CONFIGURACIÓN AVANZADA ==========
; Para ESP32 con más memoria
[env:esp32_wrover]
extends = env:esp32dev
board = esp32-wrover-kit
build_flags = 
    ${env:esp32dev.build_flags}
    -DBOARD_HAS_PSRAM=1
    -DUSE_PSRAM=1

; Para desarrollo con OTA
[env:esp32dev_ota]
extends = env:esp32dev
upload_protocol = espota
upload_port = 192.168.1.XXX
upload_flags = 
    --port=3232
    --auth=deos2024

; ========== SCRIPTS PERSONALIZADOS ==========
extra_scripts = 
    pre:scripts/pre_build.py
    post:scripts/post_build.py

; ========== CONFIGURACIÓN DE MONITOR ==========
monitor_rts = 0
monitor_dtr = 0
monitor_filters = 
    colorize
    time
    esp32_exception_decoder

; ========== CONFIGURACIÓN DE LIBRERÍAS LOCALES ==========
lib_extra_dirs = 
    lib/deos_common
    lib/fingerprint_utils
    lib/mqtt_manager

; ========== DEFINES ADICIONALES ==========
; Configuración del sensor AS608
build_flags = 
    ${env:esp32dev.build_flags}
    -DAS608_UART_NUM=2
    -DAS608_RX_PIN=16
    -DAS608_TX_PIN=17
    -DAS608_BAUD_RATE=57600
    -DAS608_SECURITY_LEVEL=3
    
; Configuración de pines
    -DLED_SUCCESS_PIN=2
    -DLED_ERROR_PIN=4
    -DLED_WIFI_PIN=5
    -DBUZZER_PIN=18
    
; Configuración de MQTT
    -DMQTT_MAX_PACKET_SIZE=1024
    -DMQTT_KEEPALIVE=60
    -DMQTT_SOCKET_TIMEOUT=15
    
; Configuración de WiFi
    -DWIFI_CONNECT_TIMEOUT=10000
    -DWIFI_RECONNECT_INTERVAL=30000
    
; Configuración del sistema
    -DMAX_OFFLINE_RECORDS=100
    -DHEARTBEAT_INTERVAL=30000
    -DCONFIG_NVS_NAMESPACE=\"deos-config\"