<button 
  mat-icon-button 
  [matMenuTriggerFor]="notificationMenu"
  matTooltip="Notificaciones"
  class="notification-bell">
  <mat-icon 
    [matBadge]="unreadCount" 
    [matBadgeHidden]="unreadCount === 0"
    matBadgeColor="warn"
    matBadgeSize="small">
    notifications
  </mat-icon>
</button>

<mat-menu #notificationMenu="matMenu" class="notification-menu" xPosition="before">
  <!-- Header -->
  <div class="notification-header" mat-menu-item [disabled]="true">
    <div class="header-content">
      <h3>Notificaciones</h3>
      <div class="header-actions">
        <button 
          mat-icon-button 
          (click)="refreshNotifications()"
          matTooltip="Actualizar"
          class="refresh-btn">
          <mat-icon>refresh</mat-icon>
        </button>
        <button 
          mat-icon-button 
          (click)="markAllAsRead()"
          [disabled]="unreadCount === 0"
          matTooltip="Marcar todas como leídas"
          class="mark-all-btn">
          <mat-icon>done_all</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <mat-divider></mat-divider>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading-container" mat-menu-item [disabled]="true">
    <div class="loading-content">
      <mat-icon class="loading-icon">refresh</mat-icon>
      <span>Cargando notificaciones...</span>
    </div>
  </div>

  <!-- No notifications -->
  <div *ngIf="!isLoading && notifications.length === 0" class="empty-state" mat-menu-item [disabled]="true">
    <div class="empty-content">
      <mat-icon class="empty-icon">notifications_none</mat-icon>
      <span>No hay notificaciones</span>
    </div>
  </div>

  <!-- Notification list -->
  <div *ngIf="!isLoading && notifications.length > 0" class="notification-list">
    <div 
      *ngFor="let notification of notifications; trackBy: trackByNotificationId"
      class="notification-item"
      [class.unread]="!notification.leida"
      (click)="onNotificationClick(notification)">
      
      <div class="notification-content">
        <div class="notification-header-item">
          <mat-icon 
            class="notification-icon"
            [style.color]="getNotificationColor(notification.tipo)">
            {{ getNotificationIcon(notification.tipo) }}
          </mat-icon>
          <div class="notification-info">
            <h4 class="notification-title">{{ notification.titulo }}</h4>
            <span class="notification-time">{{ formatTimeAgo(notification.fecha_creacion) }}</span>
          </div>
          <button 
            mat-icon-button 
            class="mark-read-btn"
            (click)="markAsRead(notification, $event)"
            [disabled]="notification.leida"
            matTooltip="Marcar como leída">
            <mat-icon>{{ notification.leida ? 'check' : 'radio_button_unchecked' }}</mat-icon>
          </button>
        </div>
        
        <p class="notification-message">{{ notification.mensaje }}</p>
        
        <div *ngIf="notification.es_global" class="global-badge">
          <mat-icon class="global-icon">public</mat-icon>
          <span>Global</span>
        </div>
      </div>
    </div>
  </div>

  <mat-divider *ngIf="notifications.length > 0"></mat-divider>

  <!-- Footer -->
  <div class="notification-footer" mat-menu-item>
    <a routerLink="/notifications" class="view-all-link">
      Ver todas las notificaciones
      <mat-icon>arrow_forward</mat-icon>
    </a>
  </div>
</mat-menu>